h1. Konfiguration des Bloonix-Agenten

p. Die Konfiguration des Agenten befindet sich in:

bc. /etc/bloonix/agent/main.conf

h2. Globale Parameter

bc. agents 1
user bloonix
group bloonix
plugins /usr/lib/bloonix/plugins
nagios_plugins /usr/lib/nagios/plugins,/usr/lib64/nagios/plugins
include /etc/bloonix/agent/conf.d

|_. Parameter |_. Standard |_. Beschreibung |
| agents | 1 | Wieviele Agenten sollen geforkt werden, um die konfigurierten Hosts zu überwachen. |
| user, group | bloonix | Mit diesen Parametern wird bestimmt, mit welchem Benutzer und welcher Gruppe der Agent läuft und die Checks ausführt. |
| plugins | /usr/local/lib/bloonix/plugins | Mit dem Parameter __plugins__ wird der Pfad angegben, unter dem die Plugins zur Ausführung liegen. Sollte der Bloonix-Agent über einen Paketmanager installiert werden, so kann der Pfad abweichen. Auf Debian werden die Plugins beispielsweise unter /usr/lib/bloonix/plugins installiert. Unter Windows liegen die Plugins höchstwahrscheinlich im Installationsverzeichnis des Agenten. |
| plugin_libdir | /var/lib/bloonix/agent | Unter diesem Pfad legen diverse Plugins Daten ab, um Deltas von statistischen Daten berechnen zu können. |
| nagios_plugins |  | Falls Sie Nagios Plugins einsetzen möchten, so können Sie hier den Pfad zu den installierten Plugins setzen. Eine komma-separierte Liste von Pfaden ist möglich. |
| include |  | Mit dem Parameter __include__ lassen sich andere Konfigurationsdateien oder sogar Verzeichnisse einbinden. Falls das Ziel ein Verzeichnis ist, so werden alle Dateien darin inkludiert, die mit __.conf__ enden. |
| use_sudo |  | Welche Checks sollen global mit sudo ausgeführt werden. Hier werden nur die Checks Skripte angegeben, ohne Pfade. Es ist möglich mehrere Skripte komma-separiert anzugeben. Die hier eingerichteten Skripts gelten für alle Hosts. |
| config_path | /etc/bloonix/agent | Dieser Parameter wird als Umgebungsvariable gesetzt (CONFIG_PATH=config_path) vor der Ausführung eines Checks. Es gibt diverse Checks, wie zum Beispiel das Skript __check-logfile__, welches diesen Pfad verwendet, um nach eigenen Konfigurationsdateien unterhalb des Pfades zu suchen. |

h3. Parameter agents

p. Dieser Parameter bestimmt, wieviele Agenten mittels fork() gestartet werden sollen, um die Daten zu sammeln. Da der Agent meistens installiert wird, um den lokalen Server zu überwachen, reicht es diesen Parameter auf 1 zu setzen. Diesen Wert höher als 1 zu setzen, lohnt sich erst, wenn der Agent mehr als einen Host überwacht.

p. Ein Agent führt immer alle konfigurierten Checks eines Host aus und sendet die Daten gebündelt zum Bloonix-Server. Wieviele Agenten schlussendlich konfiguriert werden, kommt immer darauf an, wieviele Hosts und wieviele Checks in der Summe konfiguriert sind. Ein weiterer Faktor ist auch, wie lange ein Agent benötigt um alle Checks eines Hosts auszuführen.

p. Wenn Sie zum Beispiel 10 Hosts mit je 10 Services konfiguriert haben, so sollten 3 Agenten vollkommen ausreichen, diese 10 Hosts zu prüfen.

h2. Sektion: server

bc. server {
    proto https
    host p1.bloonix.de, s1.bloonix.de
    mode failover
    ssl_options {
        ssl_verify_mode 1
        ssl_ca_file /etc/pki/tls/certs/ca-bundle.crt
        # ssl_ca_path /etc/ssl/certs
    }
}

|_. Parameter |_. Standard |_. Beschreibung |
| proto | http | Das Protokoll, unter dem der Bloonix-Server erreichbar ist. |
| host | 127.0.0.1 | Der Hostname bzw. die IP-Adresse zum Bloonix-Server. Dies kann auch eine komma-separierte Liste von IP-Adressen sein. |
| timeout | 60 | Die maximale Zeit pro Request. Danach wird der Request abgebrochen. |
| mode | balanced | Es ist möglich, die Requests auf mehrere Server zu verteilen oder aber ein Failover einzurichten. Mögliche Werte sind __balanced__ und __failover__. |

h3. Subsektion: ssl_options

|_. Parameter |_. Standard |_. Beschreibung |
| ssl_verify_mode |  | Dieser Parameter aktiviert oder deaktiviert die Validierung des Serverzertifikats. 0 = nein, 1 = ja. |
| ssl_ca_path |  | Der Pfad zu den installierten CAs. |
| ssl_ca_file |  | Der Pfad zum installierten CA Bundle. |

p. Einer der beiden Parameter, __ssl_ca_path__ oder __ssl_ca_file__, sollte konfiguriert werden.

==<% include /de/docs/configuration/template-logger.textile %>==

h2. Sektion: env

p. Hier können globale Umgebungsvariablen gesetzt werden.

bc. env {
    NAME value
}

h2. Sektion: host

bc. host {
    host_id 12345
    password secret
}

|_. Parameter |_. Standard |_. Beschreibung |
| host_id |  | Die ID des Hosts, welcher überwacht werden soll. Die ID ist im Webinterface in der Konfiguration des Hosts zu finden. |
| password |  | Das Passwort des Hosts, welcher überwacht werden soll. Das Passwort ist im Webinterface in der Konfiguration des Hosts zu finden. |
| agent_id | localhost | Jeder Service ist mit einer Agenten-ID gekennzeichnet. Mit dieser Option kann ausgewählt werden, welche Services eines Hosts von diesem Agenten aus überwacht werden. Mögliche Werte sind __localhost__, __intranet__ und __remote__. |
| active | yes | Mit diesem Parameter kann die Überwachung des Hosts aktiviert oder deaktiviert werden. |
| use_sudo |  | Welche Checks sollen mit sudo ausgeführt werden. Hier werden nur die Checks Skripte angegeben, ohne Pfade. Es ist möglich mehrere Skripte komma-separiert anzugeben. Die hier eingerichteten Skripts gelten nur für diesen Host. |
| env |  | Umgebungsvariablen für die Checks dieses Hosts. |
| execute_on_event |  | Ausführung eines Skripts bei einem bestimmten Status. |

h3. Parameter: use_sudo

p. Da der Bloonix-Agent nicht mit root-Rechten läuft, für manche Service-Checks jedoch root-Rechte benötigt werden, kann hier definiert werden, welche Service-Checks mit sudo ausgeführt werden sollen.

p. Möchten Sie zum Beispiel ein Software-RAID und die Temparatur überwachen, so benötigen die Checks __check-mdadm__ und __check-sensors__ root-Rechte. Damit der Agent diese zwei Checks mit sudo ausführt, muss folgende Konfiguration vorgenommen werden:

bc. host {
    host_id 12345
    password secret
    use_sudo check-mdadm, check-sensors
}

h3. Parameter: env

p. Mit diesem Parameter können Umgebungsvariablen des Checks geändert werden.

bc. host {
    host_id 12345
    password secret
    env {
        PATH /usr/local/bin
    }
}

h3. Parameter: execute_on_event

p. Manchmal kann es hilfreich sein, wenn man auf dem Server, der überwacht wird, bei bestimmten Ereignissen ein Skript ausführen kann. Nehmen Sie zum Beispiel an, dass Sie ein selbstgeschriebenes Skript ausführen möchten, sobald der Status für einen Service __CRITICAL__ oder __UNKNOWN__ ist. Die Einrichtung sieht beispielhaft wie folgt aus:

bc. host {
    host_id 12345
    password secret
    execute_on_event {
        check-memstat {
            status CRITICAL, UNKNOWN
            command /usr/local/bin/my-script %I %C %S
        }
    }
}

p. In der Untersektion __execute_on_event__ wird zunächst das Kommando oder die Service-ID angegeben. Im Weiteren muss angegeben werden, für welchen Status das Skript, welches unter __command__ angegben wird, ausgeführt werden soll. Die Platzhalter __%I__, __%C__ und __%S__ werden wie folgt ersetzt:

| %I | Service-ID |
| %C | Das Kommando, was ausgeührt wurde. Beispiel: check-http |
| %S | Status des Checks |

