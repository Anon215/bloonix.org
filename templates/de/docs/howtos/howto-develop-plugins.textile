p. _IN ENTWICKLUNG: Dieses HowTo ist noch nicht fertig_

h1. HowTo: Plugins entwickeln

p. Dieser Leitfaden richtet sich an Plugin Entwickler und erklärt die Standards und die Funktionsweise von Bloonix Plugins.

p. Im Verlauf dieses HowTos wird das Plugin __check-http__ von Bloonix als Beispiel verwendet. Das Plugin können Sie sich im Github Repository von Bloonix anschauen: "Github check-http":https://github.com/bloonix/bloonix-plugins-basic/blob/master/plugins/check-http

h2. Allgemeines

p. Bloonix Plugins sind eigenständige Skripts, die den Status eines oder mehrerer Services abfragen und zugleich statistische Daten zum Service liefern. Die Skripts können in jeder beliebigen Sprache geschrieben werden, wobei die Plugins, die von Bloonix entwickelt werden, in der Programmiersprache Perl entwickelt sind.

p. Jedes Plugin verfügt über diverse Optionen, ein Beispiel wäre:

bc. check-http --url https://www.bloonix.de/ --warning 3 --critical 5 --timeout 10

p. Mit diesem beispielhaften Aufruf wird die Antwortzeit des Webservers für die Domain www.bloonix.de geprüft. Benötigt die Antwort gleich oder länger als 5 Sekunden, so wird ein kritischer Status zurückgegeben. Benötigt die Antwort gleich oder länger 3 Sekunden, so wird eine Warnung zurückgegeben. Nach 10 Sekunden wird die HTTP-Abfrage abgebrochen und ein kritischer Status zurückgegeben.

p. Insbesonders ist zu beachten, dass die Optionen eines Plugins, wie zum Beispiel __--url__, __--warning__ und __--critical__, in die Datenbank von Bloonix importiert werden müssen, damit einem Benutzer bei der Konfiguration eines Service-Checks in der WebGUI die Optionen als Formularfelder zur Verfügung stehen. Wie das funktioniert, wird im weiteren Verlauf dieses HowTos eingegangen.

!{width: 640px; margin: 40px 0;}/public/img/service-settings-check-http.png!

h2. Statuscodes

p. Statuscodes spiegeln den Status eines Service wieder. Es gibt für Bloonix Plugins vier mögliche Statuscodes:

|_. Status String |_. Exitcode |_. Kurzbeschreibung |
| OK | 0 | Der Service ist verfügbar. Es gibt keinen Handlungsbedarf. |
| WARNING | 1 | Der Service ist verfügbar, es gibt Handlungsbedarf, aber nicht dringend. |
| CRITICAL | 2 | Der Service befindet sich in einem kritischen Status. Es gibt dringenden Handlungsbedarf. |
| UNKNOWN | 3 | Das Bloonix Plugin konnte nicht ausgeführt werden oder hat einen unerwarteten Fehler geliefert. |

p. Es gibt natürlich für jeden Status Raum für unterschiedliche Interpretationen. Zu beachten ist jedoch, dass der Status __UNKNOWN__ einzig den Status des Plugins selbst beschreibt und nicht den Status eines Service. Das könnte zum Beispiel der Fall sein, wenn das Plugin __check-http__ nicht ausgeführt werden konnte, weil das Programm __curl__ nicht installiert ist oder weil die Parameterübergabe fehlerhaft war. Sobald alle Abhängigkeiten eines Plugins erfüllt sind, so muss der Status __OK__, __WARNING__ oder __CRITICAL__ sein.

h3. Plugins ausführen

p. Die Plugins von Bloonix können für Testzwecke über Kommandozeilenparametern aufgerufen werden. Beispiel:

bc. check-http --url https://www.bloonix.de/ --warning 3 --critical 5 --timeout 10

p. Der Bloonix Agent, welcher für die Ausführung der Plugins verantwortlich ist, übergibt die Optionen jedoch über __STDIN__ an das Plugin und im JSON-Format. Der Bloonix Agent verwendet die Option __--stdin__, um die Übergabe der Optionen über __STDIN__ einzuleiten. Die Ausgabe des Plugins erfolgt in einer einzigen Zeile und ebenfalls im JSON-Format. Um eine lesbare Ausgabe zu erhalten, sollte der Parameter __--pretty__ fürs Debugging implementiert werden.

p. Es folgt ein beispielhafter Aufruf des Plugins __check-http__:

bc. check-http --stdin --pretty
{"url":"https://www.bloonix.de","warning":3,"critical":5,"timeout":10}

p. Die Ausgabe sieht in etwa so aus:

bc. {
   "status" : "OK",
   "debug" : {
      "http-header" : {
         "Connection" : "keep-alive",
         "Server" : "nginx",
         "Content-Type" : "text/html; charset=utf-8",
         "Transfer-Encoding" : "chunked",
         "Date" : "Wed, 24 Dec 2014 13:36:51 GMT"
      },
      "ipaddr" : "127.0.0.1"
   },
   "stats" : {
      "time" : "16.433"
   },
   "message" : "HTTP/1.1 200 OK, response in 0.016433s, 10764 bytes, IP: 127.0.0.1"
}

h2. Optionen

p. Die Optionen eines Plugins werden dazu verwendet, dem Plugin bestimmte Anweisungen zur Ausführung zu geben. Zum Beispiel kann über den Parameter __--help__ eine Hilfe zu einem Plugin abgerufen werden. Eine Kurzversion der Optionen, zum Beispiel __-h__ für die Hilfe, gibt es nicht. Alle Optionen gibt es nur im langen Format.

p. Jedes Bloonix Plugin muss über mindestens 5 Optionen verfügen. Diese sind wie folgt:

|_. Parameter |_. Beschreibung |
| --version | Ausgabe der Version des Plugins. |
| --help | Ausgabe einer Hilfe zum Plugin mit Auflistung der Optionen. |
| --plugin-info | Ausführliche Informationen über das Plugin im JSON-Format. |
| --stdin | Anweisung an das Plugin, die Optionen zur Ausführung über den STDIN-Kanal zu lesen. |
| --pretty | Anweisung an das Plugin, den JSON-String in einem leserlichen Format auszugeben. |

p. Die Optionen __--help__ und __--plugin-info__ sind fast identisch. Die Option __--help__ gibt die Hilfe so aus, wie es bei Programmen üblich ist:

bc.. check-http --help

Usage: check-http [ OPTIONS ]

Options:

--url <url>
    This is the HTTP or HTTPS request you want to check. Please enter the full URL with the query string.
    This option is mandatory.
--warning <seconds>
    A value in seconds. When the check takes longer than this time then a warning status is triggered.
    Default: 3
--critical <seconds>
    A value in seconds. When the check takes longer than this time then a critical status is triggered.
    Default: 5
--timeout <seconds>
    A timeout in seconds after its expiration the check is aborted and a critical status is triggered.
    Default: 10
--version
    Print the version.
--help
    Print the help.
--plugin-info
    Print plugin information as JSON string.
--pretty
    Print the plugin information in pretty format
...
...

p. Die Option __--plugin-info__ gibt die Informationen einen Plugins im JSON-Format aus, so dass diese Daten in die Datenbank von Bloonix importiert werden können. Dabei werden erweiterte Informationen zum Plugin ausgegeben. Weiteres erfährst du im nächsten Kapitel.

h2. Informationen eines Plugins in die Bloonix Datenbank importieren

p. In Bearbeitung.

h2. Ein Plugin Step für Step entwickeln

p. In Bearbeitung.

